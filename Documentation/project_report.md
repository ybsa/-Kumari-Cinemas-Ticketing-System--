# Kumari Cinemas Ticketing System - Final Project Report

## 1. Introduction

This project implements a web-based database application for Kumari Cinemas, a cinema chain in Nepal. The goal is to provide a centralized ticket management system that addresses existing discrepancies in location, hall management, and operational costs.

## 2. Database Design & Analysis

### 2.1 Normalization & Design Decisions

The database was strictly designed following **Third Normal Form (3NF)** principles to eliminate data redundancy and ensure integrity.

- **1NF (Atomicity)**: All attributes are atomic. For example, `ShowDateTime` is a single timestamp, and `Address` is kept as a single unit relevant to the business.
- **2NF (Partial Dependencies)**: All non-key attributes are fully functional dependent on the Primary Key. For instance, `MovieTitle` depends solely on `MovieId`, not on `ShowId`.
- **3NF (Transitive Dependencies)**: Transitive dependencies were removed. `BranchLocation` is linked to `BranchId`, not repeated in `M_Halls`.

### 2.2 Entity Relationship Diagram (ERD) & Constraints

The system uses a relational model designed in **Oracle SQL Developer Data Modeler**. Key structural decisions include:

- **Relationships**:
  - **One-to-Many (Branches → Halls)**: A branch (e.g., Pokhara) has multiple physical halls.
  - **One-to-Many (Movies → Shows)**: A single movie is screened multiple times.
  - **One-to-Many (Shows → Bookings)**: A specific show instance tracks multiple user bookings.

- **Key Constraints**:
  - **Primary Keys (PK)**: `Generated by Default as Identity` used for robust auto-incrementing.
  - **Foreign Keys (FK)**: Enforce referential integrity (e.g., a Booking cannot exist without a valid User).
  - **Check Constraints**: Enforce business rules at the database level (e.g., `Capacity > 0`, `TotalTickets > 0`, `BasePrice >= 0`).

## 3. System Implementation

### 3.1 Dynamic Pricing (Business Logic Layer)

The pricing strategy is implemented in the application layer (`PricingService.cs`) rather than the database to maintain flexibility.
- **Base Price**: Fetched from the `M_Shows` table.
- **Rules Engine**:
    1. **New Releases**: If `ReleaseDate` is within 7 days, a **20% premium** is applied.
    2. **Public Holidays**: Checked against a hardcoded list of dates; a **15% surcharge** is added.
- This separation ensures that pricing rules can be changed without altering the database schema.

### 3.2 Automated Cancellation (Background Service)

To address the "1-hour rule" requirement, the system uses an ASP.NET Core `IHostedService`.

1. **Trigger**: The service (`BookingCleanupService`) wakes up every **15 minutes**.
2. **Logic**: It executes a precise SQL query comparing the current server time against the `ShowDateTime`.
3. **Action**: Any booking with `Status = 'BOOKED'` (unpaid) found to be for a show starting in less than 1 hour is implicitly updated to `'CANCELLED'`.
4. **Result**: Seats are immediately freed up for new customers without manual intervention.

**Edge Case Handling (Server Time Authority)**:
The system strictly uses **Server Time** for all calculations, not the client/user device time. This prevents manipulation where a user might change their system clock to bypass the "1-hour rule" (e.g., booking at 59 minutes before the show).

### 3.3 Data Integrity & Validation

To prevent overbooking, the system implements a real-time capacity check. Before any booking is confirmed, the system queries the **M_Halls** capacity and compares it against the existing **TotalTickets** for that specific show. If the hall is full, the transaction is rejected, ensuring physical constraints are respected.

**Precision Timing**: To support the "1-hour cancellation" rule with absolute accuracy, the database uses **`TIMESTAMP`** data types for `ShowDateTime` instead of simple date/string combinations. This eliminates ambiguity in timezone or format conversions.

### 3.4 Security Implementation

The system adopts a "security-first" mindset for key data:

1. **SQL Injection Defense**: All database interactions use **Parameterized Queries** (e.g., `:userId`, `:showId` placeholders in OracleCommand). This prevents attackers from injecting malicious SQL code.
2. **Password Security**: Passwords are hashed using **PBKDF2 (SHA256)** with 100,000 iterations. Plain text storage is strictly avoided.
3. **Authorization**: Access to booking features is restricted to authenticated users (Session Management).

### 3.5 UI/UX Design

The web frontend was built using ASP.NET Core MVC with a focus on modern design principles:

- **Dark Mode**: Reduces eye strain and offers a cinematic feel.
- **Glassmorphism**: Provides a premium, sophisticated look.
- **Responsive Layout**: Ensures the system is usable on both desktop and mobile devices.

### 3.6 User Experience Flow

The user journey is designed to be linear and intuitive:

1. **Registration**: User signs up with a unique username and secure password (hashed).
2. **Discovery**: User views available movies; "New Release" badges and prices are auto-calculated.
3. **Booking**: User selects a show, enters ticket quantity, and sees the final price update instantly.
4. **Validation**: System checks hall capacity. If seats are available, the booking is confirmed (`Status: BOOKED`).
5. **Completion**: User pays (simulated) to finalize (`Status: PAID`). If they delay, the auto-cancellation frees the seats.

## 4. Limitations & Future Improvements

While the current system functionality is robust given the prototype scope, the following constraints are acknowledged:

### 4.1 Known Limitations

1. **Payment Processing**: For this prototype, **payment is simulated** and assumed successful. Real-time gateway integration (eSewa/Khalti) is out of scope.
2. **Notification System**: The system does not currently send SMS or Email confirmations upon booking or cancellation.
3. **Concurrency (Seat Locking)**: In a high-traffic production environment, two users might try to book the last seat simultaneously. A "Seat Locking" mechanism (holding a seat for 5 mins while paying) would be required to prevent race conditions.
4. **Refund Automation**: Cancelled tickets do not automatically trigger a refund process in this version.

### 4.2 Future Road Map

1. **Interactive Seat Map**: Replacing the 'Quantity' input with a visual seat picker.
2. **Admin Dashboard**: A web-based interface for managers to add movies/shows.
3. **Mobile Application**: React Native companion app.

## 5. Conclusion

The prototype successfully meets all core requirements of the KumariCinemas case study, providing a robust, automated, and user-friendly solution for modern cinema management.
