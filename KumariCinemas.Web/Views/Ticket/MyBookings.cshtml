@model IEnumerable<KumariCinemas.Web.Models.Booking>

@{
    ViewData["Title"] = "My Bookings";
}

<div class="booking-container">
    <header class="page-header">
        <h1>My Bookings</h1>
    </header>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            @TempData["Success"]
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">
            @TempData["Error"]
        </div>
    }

    <div class="bookings-list">
        @if (!Model.Any())
        {
            <div class="empty-state">
                <p>You have no bookings yet.</p>
                <a asp-controller="Ticket" asp-action="Index" class="btn-primary">Browse Movies</a>
            </div>
        }
        else
        {
            @foreach (var booking in Model)
            {
                <div class="booking-item">
                    <div class="info">
                        <h3>@booking.MovieTitle</h3>
                        <p class="show-date">@booking.ShowDateTime.ToString("MMM dd, yyyy - hh:mm tt")</p>
                        <p class="status @booking.Status.ToLower()">@booking.Status</p>
                    </div>
                    <div class="price">
                        <span class="qty-badge">@booking.TotalTickets Tickets</span>
                        <span>Total Price</span>
                        <strong>Rs. @booking.FinalPrice</strong>
                        
                        @{
                            var canCancel = booking.Status != "CANCELLED" && (booking.ShowDateTime - DateTime.Now).TotalHours >= 2;
                        }
                        
                        @if (canCancel)
                        {
                            <form asp-action="CancelBooking" method="post" style="margin-top: 10px;" 
                                  onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                                <input type="hidden" name="bookingId" value="@booking.BookingId" />
                                <button type="submit" class="btn-cancel">Cancel Booking</button>
                            </form>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

<style>
    .booking-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
    .booking-item {
        background: rgba(255, 255, 255, 0.05);
        margin-bottom: 15px;
        padding: 20px;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .status { font-weight: 700; text-transform: uppercase; font-size: 0.8rem; }
    .status.booked { color: #f1c40f; }
    .status.paid { color: #2ecc71; }
    .status.cancelled { color: #e74c3c; }
    .price { text-align: right; }
    .price span { display: block; color: #b3b3b3; font-size: 0.8rem; }
    .qty-badge { 
        background: rgba(255, 255, 255, 0.1); 
        padding: 2px 8px; 
        border-radius: 4px; 
        margin-bottom: 5px; 
        display: inline-block !important; 
    }
    .btn-cancel {
        padding: 6px 16px;
        background: transparent;
        border: 1px solid #e74c3c;
        color: #e74c3c;
        border-radius: 6px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s;
    }
    .btn-cancel:hover {
        background: rgba(231, 76, 60, 0.2);
    }
    .alert {
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
    }
    .alert-success {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
        border: 1px solid #2ecc71;
    }
    .alert-danger {
        background: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
        border: 1px solid #e74c3c;
    }
</style>
